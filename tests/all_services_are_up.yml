---
- hosts: localhost
  gather_facts: no
  vars:
    services_health_checks:
      - https://voot.vm.openconext.org/health
      - https://teams.vm.openconext.org/health
      - https://aa.vm.openconext.org/aa/api/health
      - https://multidata.vm.openconext.org/health
      - https://pdp.vm.openconext.org/pdp/api/health
  tasks:
    - uri: url={{ item }} return_content=yes
      register: result
      until: "'UP' in result.content"
      retries: 5
      delay: 10
      with_items: "{{ services_health_checks }}"
